<section id="starred">
  <h2>Featured Projects</h2>
  <div class="carousel" id="carousel">
    <button class="carousel-btn prev" onclick="changeSlide(-1)" aria-label="Previous slide">‹</button>
    <button class="carousel-btn next" onclick="changeSlide(1)" aria-label="Next slide">›</button>

    <div class="carousel-wrapper" id="carouselWrapper">
      {{ range where .Site.RegularPages "Section" "projects" }}
        {{ if .Params.starred }}
          <div class="slide">
            {{ partial "project-image.html" . }}
            <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
            <p>{{ .Params.summary }}</p>
          </div>
        {{ end }}
      {{ end }}
    </div>

    <div class="carousel-dots" id="carouselDots"></div>
  </div>
</section>

<script>
  (function() {
    const wrapper = document.getElementById('carouselWrapper');
    const carousel = document.getElementById('carousel');
    const dotsContainer = document.getElementById('carouselDots');

    if (!wrapper || !carousel) return;

    const slides = wrapper.querySelectorAll('.slide');
    const totalSlides = slides.length;

    if (totalSlides === 0) return;

    let currentIndex = 0;
    let autoplayInterval;
    let touchStartX = 0;
    let touchEndX = 0;

    // Create dots
    for (let i = 0; i < totalSlides; i++) {
      const dot = document.createElement('span');
      dot.className = 'carousel-dot';
      if (i === 0) dot.classList.add('active');
      dot.onclick = () => goToSlide(i);
      dotsContainer.appendChild(dot);
    }

    const dots = dotsContainer.querySelectorAll('.carousel-dot');

    function updateSlide() {
      wrapper.style.transform = `translateX(-${currentIndex * 100}%)`;

      // Update dots
      dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentIndex);
      });
    }

    function goToSlide(index) {
      currentIndex = index;
      updateSlide();
      resetAutoplay();
    }

    window.changeSlide = function(direction) {
      currentIndex = (currentIndex + direction + totalSlides) % totalSlides;
      updateSlide();
      resetAutoplay();
    }

    function startAutoplay() {
      autoplayInterval = setInterval(() => {
        currentIndex = (currentIndex + 1) % totalSlides;
        updateSlide();
      }, 3000);
    }

    function stopAutoplay() {
      clearInterval(autoplayInterval);
    }

    function resetAutoplay() {
      stopAutoplay();
      startAutoplay();
    }

    // Touch/swipe support
    carousel.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
    });

    carousel.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });

    function handleSwipe() {
      const swipeThreshold = 50;
      const diff = touchStartX - touchEndX;

      if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0) {
          // Swipe left - next slide
          window.changeSlide(1);
        } else {
          // Swipe right - previous slide
          window.changeSlide(-1);
        }
      }
    }

    // Pause on hover (desktop only)
    carousel.addEventListener('mouseenter', stopAutoplay);
    carousel.addEventListener('mouseleave', startAutoplay);

    // Start autoplay
    startAutoplay();
  })();
</script>
